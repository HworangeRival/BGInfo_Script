Function GetCurrentMoonPhase()
    Dim JD, IP, AG, phase
    JD = (CDbl(Now()) - 2451550.1) / 29.530588853
    IP = JD - Int(JD)
    AG = IP * 29.53
    
    Select Case AG
        Case 0 To 1.84566: phase = "Luna Nuova"
        Case 1.84566 To 5.53699: phase = "Luna Crescente"
        Case 5.53699 To 9.22831: phase = "Primo Quarto"
        Case 9.22831 To 12.91963: phase = "Gibbosa Crescente"
        Case 12.91963 To 16.61096: phase = "Luna Piena"
        Case 16.61096 To 20.30228: phase = "Gibbosa Calante"
        Case 20.30228 To 23.99361: phase = "Ultimo Quarto"
        Case 23.99361 To 27.68493: phase = "Luna Calante"
        Case Else: phase = "Luna Nuova"
    End Select
    
    GetCurrentMoonPhase = phase
End Function

echo GetCurrentMoonPhase


'
'                     :::    ::: :::       :::  ::::::::  :::::::::      :::     ::::    :::  ::::::::  ::::::::::      :::::::::  ::::::::::: :::     :::     :::     :::                             
'        :+: :+:      :+:    :+: :+:       :+: :+:    :+: :+:    :+:   :+: :+:   :+:+:   :+: :+:    :+: :+:             :+:    :+:     :+:     :+:     :+:   :+: :+:   :+:             :+: :+:         
'                     +:+    +:+ +:+       +:+ +:+    +:+ +:+    +:+  +:+   +:+  :+:+:+  +:+ +:+        +:+             +:+    +:+     +:+     +:+     +:+  +:+   +:+  +:+                             
'                     +#++:++#++ +#+  +:+  +#+ +#+    +:+ +#++:++#:  +#++:++#++: +#+ +:+ +#+ :#:        +#++:++#        +#++:++#:      +#+     +#+     +:+ +#++:++#++: +#+                             
'                     +#+    +#+ +#+ +#+#+ +#+ +#+    +#+ +#+    +#+ +#+     +#+ +#+  +#+#+# +#+   +#+# +#+             +#+    +#+     +#+      +#+   +#+  +#+     +#+ +#+                             
'#+# #+# #+# #+#      #+#    #+#  #+#+# #+#+#  #+#    #+# #+#    #+# #+#     #+# #+#   #+#+# #+#    #+# #+#             #+#    #+#     #+#       #+#+#+#   #+#     #+# #+#             #+# #+# #+# #+# 
'### ###              ###    ###   ###   ###    ########  ###    ### ###     ### ###    ####  ########  ##########      ###    ### ###########     ###     ###     ### ##########              ### ### 
'
